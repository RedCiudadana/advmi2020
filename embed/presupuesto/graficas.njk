{% extends "base.njk" %}

{# Esto es para no mostrar el navbar #}
{% block navbar %}
{% endblock %}

{% block main %}
    <section class="section-graph">
        <div class="questions-container">
            <div id="tabs" style="margin-bottom: 2rem;">
                <ul>
                    <li>
                        <a href="#tabs-1">
                            Ejecución institución
                        </a>
                    </li>
                    <li>
                        <a href="#tabs-2">
                            Financiamiento
                        </a>
                    </li>
                    <li>
                        <a href="#tabs-3">
                            Transferencias
                        </a>
                    </li>
                </ul>
                {# Start Ejecución institución #}
                <div id="tabs-1">
                    <div id="tabs-1-years" class="tabs-nolayout" style="margin-bottom: 2rem;">
                        <ul>
                            <li>
                                <a href="#tabs-1-2020">
                                    2020
                                </a>
                            </li>
                            <li>
                                <a href="#tabs-1-2019">
                                    2019
                                </a>
                            </li>
                            <li>
                                <a href="#tabs-1-2018">
                                    2018
                                </a>
                            </li>
                            <li>
                                <a href="#tabs-1-2017">
                                    2017
                                </a>
                            </li>
                            <li>
                                <a href="#tabs-1-2016">
                                    2016
                                </a>
                            </li>
                        </ul>
                        <div id="tabs-1-2020">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-1-2020"></div>
                            </div>
                        </div>
                        <div id="tabs-1-2019">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-1-2019"></div>
                            </div>
                        </div>
                        <div id="tabs-1-2018">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-1-2018"></div>
                            </div>
                        </div>
                        <div id="tabs-1-2017">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-1-2017"></div>
                            </div>
                        </div>
                        <div id="tabs-1-2016">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-1-2016"></div>
                            </div>
                        </div>
                    </div>
                </div>
                {# End Ejecución institución #}
                {# Start Financiamiento #}
                <div id="tabs-2">
                    <div id="tabs-2-years" class="tabs-nolayout" style="margin-bottom: 2rem;">
                        <ul>
                            <li>
                                <a href="#tabs-2-2020">
                                    2020
                                </a>
                            </li>
                            <li>
                                <a href="#tabs-2-2019">
                                    2019
                                </a>
                            </li>
                            <li>
                                <a href="#tabs-2-2018">
                                    2018
                                </a>
                            </li>
                            <li>
                                <a href="#tabs-2-2017">
                                    2017
                                </a>
                            </li>
                            <li>
                                <a href="#tabs-2-2016">
                                    2016
                                </a>
                            </li>
                        </ul>
                        <div id="tabs-2-2020">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-2-2020"></div>
                            </div>
                        </div>
                        <div id="tabs-2-2019">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-2-2019"></div>
                            </div>
                        </div>
                        <div id="tabs-2-2018">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-2-2018"></div>
                            </div>
                        </div>
                        <div id="tabs-2-2017">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-2-2017"></div>
                            </div>
                        </div>
                        <div id="tabs-2-2016">
                            <div class="section-treemap-tab-1" style="height: 440px; width: 80%; margin: auto;">
                                <div id="treemap-2-2016"></div>
                            </div>
                        </div>
                    </div>
                </div>
                {# End Financiamiento #}
                {# Start Transferencias #}
                <div id="tabs-3">
                    <table>
                        <thead>
                            <th style="max-width: 250px;">Origen</th>
                            <th style="max-width: 250px;">Final</th>
                            <th>Monto</th>
                        </thead>
                        <tbody>
                            {%- for item in transferencias %}
                                <tr>
                                    <td style="max-width: 150px;">{{ item.Origen }}</td>
                                    <td>{{ item.Final }}</td>
                                    <td>Q{{ item.Transferencia | toLocaleString }}</td>
                                </tr>
                            {% endfor -%}
                        </tbody>
                    </table>
                </div>
                {# End Transferencias #}
            </div>
        </div>
        <div class="section-update">
            <span class="update-label">
                <span class="update-strong">Clasificacion Funcional del Presupuesto</span>
                <span class="update-source">Fuente: Ministerio de Finanzas Publicas. Portal de Datos Abiertos</span>
            </span>
            <div class="update-actions">
                <div class="update-time">
                    <i class="fa fa-clock-o" aria-hidden="true"></i>
                    Actualizado el: 
                    <span class="time-clock">{{resumen.FechaPresupuesto.dato}}</span>
                </div>
                <div class="update-download">
                    <a href="{{resumen.DescargarCSV.dato}}" class="download-option"><i class="fa fa-download" aria-hidden="true"></i>{{resumen.DescargarCSV.titulo}}</a>
                    <a href="{{resumen.DescargarExcel.dato}}" class="download-option"><i class="fa fa-download" aria-hidden="true"></i>{{resumen.DescargarExcel.titulo}} </a>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{# Esto es para no mostrar el footer #}
{% block footer %}
{% endblock %}

{% block page_scripts %}
    <script src = "https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link href = "https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel ="stylesheet">
    <script>
        $(function() {
            $( "#tabs" ).tabs();
            $( "#tabs-1-years" ).tabs();
            $( "#tabs-2-years" ).tabs();
        });
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js"></script>
    <script type="text/javascript" src="/js/main.js"></script> 
    <script type="text/javascript">
        var treemap = {{ treemap | dump | safe }};
        var financiamiento = {{ financiamiento | dump | safe }};

        var treemap2020 = treemap.filter((item) => item.year === 2020);
        var treemap2019 = treemap.filter((item) => item.year === 2019);
        var treemap2018 = treemap.filter((item) => item.year === 2018);
        var treemap2017 = treemap.filter((item) => item.year === 2017);
        var treemap2016 = treemap.filter((item) => item.year === 2016);

        var financiamiento2020 = financiamiento.filter((item) => item.year === 2020);
        var financiamiento2019 = financiamiento.filter((item) => item.year === 2019);
        var financiamiento2018 = financiamiento.filter((item) => item.year === 2018);
        var financiamiento2017 = financiamiento.filter((item) => item.year === 2017);
        var financiamiento2016 = financiamiento.filter((item) => item.year === 2016);

        var getRandomData = function() {
            return [
                {
                    concepto: 'Transparencia',
                    monto: Math.round((Math.random() * 100))
                },
                {
                    concepto: 'Salud',
                    monto: Math.round((Math.random() * 100))
                },
                {
                    concepto: 'Seguridad',
                    monto: Math.round((Math.random() * 100))
                },
                {
                    concepto: 'Asuntos Económicos',
                    monto: Math.round((Math.random() * 100))
                },
                {
                    concepto: 'Protección Social',
                    monto: Math.round((Math.random() * 100))
                },
            ];
        };

        var createTreemap = function(id, data, idLabel, sizeLabel) {
            d3plus.viz()
                .container(id)
                .data(data ? data : getRandomData())
                .type("tree_map")
                .id(idLabel ? idLabel : "concepto")
                .format(
                    {
                        locale: 'es_ES'
                    }
                )
                .size(sizeLabel ? sizeLabel : "monto")
                .font({ "family": "Aileron SemiBold" })
                .draw();
        };

        createTreemap('#treemap-1-2020', treemap2020, "Concepto", "Devengado");
        createTreemap('#treemap-1-2019', treemap2019, "Concepto", "Devengado");
        createTreemap('#treemap-1-2018', treemap2018, "Concepto", "Devengado");
        createTreemap('#treemap-1-2017', treemap2017, "Concepto", "Devengado");
        createTreemap('#treemap-1-2016', treemap2016, "Concepto", "Devengado");

        createTreemap('#treemap-2-2020', financiamiento2020, "Concepto", "Ingreso");
        createTreemap('#treemap-2-2019', financiamiento2019, "Concepto", "Ingreso");
        createTreemap('#treemap-2-2018', financiamiento2018, "Concepto", "Ingreso");
        createTreemap('#treemap-2-2017', financiamiento2017, "Concepto", "Ingreso");
        createTreemap('#treemap-2-2016', financiamiento2016, "Concepto", "Ingreso");
    </script>
{% endblock %}

{% block page_styles %}
    <style>
        .ui-tabs-nav {
            font-family: 'Aileron Bold', sans-serif;
            width: 100%;
            height: 92px;
            font-size: 27px;
            color: #fff;
            background: #653FE0;
        }

        .ui-tabs .ui-tabs-nav .ui-tabs-anchor {
            color: white !important;
        }

        .ui-tabs .ui-tabs-nav li {
            background: unset !important;
            border: unset !important;
        }

        .ui-widget-header {
            border: unset;
        }

        .ui-tabs-nav {
            height: auto;
        }

        .ui-widget-content {
            border: 1px solid #dddddd;
            background: #eeeeee;
        }

        .ui-tabs-panel {
            padding: 2rem 4rem;
        }

        .tabs-nolayout, .tabs-nolayout * {
            border: unset !important;
            background-color: unset !important;
            color: #404041 !important;
        }

        .tabs-nolayout.ui-tabs .ui-tabs-nav .ui-tabs-anchor {
            color: #404041 !important;
        }

        .tabs-nolayout .ui-tabs-active a {
            text-decoration: underline !important;
        }
    </style>
{% endblock %}